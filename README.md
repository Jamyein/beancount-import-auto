# Beancount AI è´¦å•æ™ºèƒ½å¯¼å…¥å·¥å…·

ä¸€ä¸ªåŸºäº Beancount çš„ä¸ªäººè®°è´¦ç³»ç»Ÿï¼Œæ”¯æŒæ”¯ä»˜å®ã€å¾®ä¿¡ã€é“¶è¡Œç­‰è´¦å•çš„æ™ºèƒ½å¯¼å…¥å’Œ AI åˆ†ç±»ã€‚

## ğŸŒŸ ä¸»è¦åŠŸèƒ½

- **å¤šå¹³å°è´¦å•å¯¼å…¥**: æ”¯æŒæ”¯ä»˜å®ã€å¾®ä¿¡æ”¯ä»˜ã€é“¶è¡Œæµæ°´ç­‰ä¸»æµè´¦å•æ ¼å¼
- **AI æ™ºèƒ½åˆ†ç±»**: é›†æˆ DeepSeek AIï¼Œè‡ªåŠ¨è¯†åˆ«äº¤æ˜“åˆ†ç±»å¹¶å­¦ä¹ ç”¨æˆ·ä¹ æƒ¯
- **è‡ªåŠ¨åŒ–å¤„ç†**: ä¸€é”®å¯¼å…¥ã€è‡ªåŠ¨å½’æ¡£ã€æŒ‰æœˆåˆ†å·å­˜å‚¨
- **å¯è§†åŒ–æŠ¥è¡¨**: é›†æˆ Fava è´¢åŠ¡åˆ†æå·¥å…·ï¼Œæä¾›ä¸°å¯Œçš„å›¾è¡¨å’ŒæŠ¥è¡¨
- **è®°å¿†å­¦ä¹ **: ç³»ç»Ÿä¼šè®°ä½ç”¨æˆ·çš„åˆ†ç±»é€‰æ‹©ï¼Œè¶Šç”¨è¶Šå‡†ç¡®

## ğŸ“ é¡¹ç›®ç»“æ„

```
beancount-import-auto/
â”œâ”€â”€ main.beancount          # ä¸»è´¦æœ¬æ–‡ä»¶
â”œâ”€â”€ equity.beancount        # æƒç›Šå’ŒæœŸåˆä½™é¢è®¾ç½®
â”œâ”€â”€ config/                 # é…ç½®æ–‡ä»¶ç›®å½•
â”‚   â”œâ”€â”€ config.json         # ä¸»é…ç½®æ–‡ä»¶
â”‚   â””â”€â”€ mapping.json        # AI åˆ†ç±»æ˜ å°„ç¼“å­˜
â”œâ”€â”€ scripts/                # Python è„šæœ¬ç›®å½•
â”‚   â”œâ”€â”€ importer_main.py    # ä¸»å¯¼å…¥è„šæœ¬
â”‚   â”œâ”€â”€ importer_alipay.py  # æ”¯ä»˜å®è´¦å•è§£æ
â”‚   â”œâ”€â”€ importer_wechat.py  # å¾®ä¿¡è´¦å•è§£æ
â”‚   â”œâ”€â”€ importer_bank.py    # é“¶è¡Œè´¦å•è§£æ
â”‚   â”œâ”€â”€ memory_brain.py     # AI åˆ†ç±»æ ¸å¿ƒ
â”‚   â”œâ”€â”€ init_beancount.py   # åˆå§‹åŒ–è„šæœ¬
â”‚   â”œâ”€â”€ start-fava.ps1      # Fava å¯åŠ¨è„šæœ¬
â”‚   â””â”€â”€ selector.ps1        # æ–‡ä»¶å½’æ¡£è„šæœ¬
â”œâ”€â”€ data/                   # æŒ‰æœˆåˆ†å·çš„è´¦æœ¬æ–‡ä»¶ï¼ˆè‡ªåŠ¨ç”Ÿæˆï¼‰
â”œâ”€â”€ bills/                  # å¾…å¤„ç†è´¦å•æ–‡ä»¶å¤¹
â”œâ”€â”€ run.bat                 # ä¸»ç¨‹åºå¯åŠ¨è„šæœ¬
â””â”€â”€ fava_run.bat           # Fava å¯åŠ¨è„šæœ¬
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒå‡†å¤‡

#### ç³»ç»Ÿè¦æ±‚
- **Python**: 3.7+
- **æ“ä½œç³»ç»Ÿ**: Windows (ä¸»è¦æ”¯æŒï¼Œä½¿ç”¨ .bat å’Œ .ps1 è„šæœ¬)
- **PowerShell**: ç”¨äº Fava å¯åŠ¨è„šæœ¬

#### å®‰è£…ä¾èµ–

**æ ¸å¿ƒä¾èµ–ï¼ˆå¿…éœ€ï¼‰ï¼š**
```bash
pip install openai beancount fava pandas python-dateutil
```

**å¯é€‰ä¾èµ–ï¼š**
```bash
# PDF é“¶è¡Œè´¦å•è§£ææ”¯æŒï¼ˆå¦‚éœ€å¤„ç† PDF æ ¼å¼é“¶è¡Œæµæ°´ï¼‰
pip install PyPDF2
```

#### å„ä¾èµ–ç”¨é€”è¯´æ˜

| ä¾èµ–åŒ… | ç”¨é€” | ä½¿ç”¨åœºæ™¯ |
|--------|------|----------|
| **openai** | AI åˆ†ç±»åŠŸèƒ½ | è°ƒç”¨ DeepSeek API è¿›è¡Œæ™ºèƒ½äº¤æ˜“åˆ†ç±» |
| **beancount** | æ ¸å¿ƒè®°è´¦å¼•æ“ | å¤å¼è®°è´¦ç³»ç»Ÿï¼Œè§£æ beancount æ ¼å¼æ–‡ä»¶ |
| **fava** | å¯è§†åŒ–æŠ¥è¡¨ç•Œé¢ | æä¾› Web ç•Œé¢æŸ¥çœ‹è´¢åŠ¡æŠ¥è¡¨å’Œå›¾è¡¨ |
| **pandas** | æ•°æ®å¤„ç† | è§£æå¾®ä¿¡/é“¶è¡Œè´¦å•çš„ CSV/XLSX æ–‡ä»¶ |
| **python-dateutil** | æ—¥æœŸè§£æ | å¤„ç†å„ç§æ—¥æœŸæ ¼å¼ |
| **PyPDF2** | PDF è§£æ | è§£æé“¶è¡Œå¯¼å‡ºçš„ PDF æ ¼å¼æµæ°´ï¼ˆå¯é€‰ï¼‰ |

#### éªŒè¯å®‰è£…

```bash
# éªŒè¯æ ¸å¿ƒä¾èµ–
python -c "import openai, beancount, fava, pandas, dateutil; print('æ‰€æœ‰ä¾èµ–å®‰è£…æˆåŠŸ')"

# éªŒè¯ Fava å¯åŠ¨
fava --version
```

### 2. é…ç½®è®¾ç½®

ç¼–è¾‘ `config/config.json` æ–‡ä»¶ï¼š

```json
{
    "openai": {
        "api_key": "your_deepseek_api_key",
        "api_base": "https://api.deepseek.com",
        "model": "deepseek-chat"
    },
    "main_bean_file": "main.beancount",
    "monthly_dir": "data",
    "asset_mapping": {
        "Alipay": "Assets:Alipay:Cash",
        "wechat": "Assets:WeChat"
    },
    "my_accounts": [
        "Expenses:Food",
        "Expenses:Shopping",
        "Expenses:Transport",
        "Expenses:Housing",
        "Expenses:Entertainment",
        "Expenses:Health",
        "Expenses:Car",
        "Expenses:Other",
        "Income:Salary",
        "Income:RedPacket",
        "Income:Refund",
        "Equity:Opening-Balances"
    ]
}
```

### 3. ä¸€æ¬¡æ€§åˆå§‹åŒ–ï¼ˆæ¨èé¦–æ¬¡ä½¿ç”¨ï¼‰

é¡¹ç›®æä¾›äº†è‡ªåŠ¨åŒ–åˆå§‹åŒ–è„šæœ¬ï¼Œå¯ä»¥å¿«é€Ÿåˆ›å»ºæ‰€æœ‰å¿…è¦çš„è´¦æˆ·å’ŒæœŸåˆä½™é¢ï¼š

```bash
# è¿è¡Œåˆå§‹åŒ–è„šæœ¬
python scripts/init_beancount.py
```

### 4. å¯¼å…¥è´¦å•

1. å°†è´¦å•æ–‡ä»¶ï¼ˆCSV/XLSXï¼‰æ”¾å…¥ `bills/` æ–‡ä»¶å¤¹
2. è¿è¡Œä¸»ç¨‹åºï¼š
   ```bash
   # Windows
   run.bat
   
   # æˆ–ç›´æ¥è¿è¡Œ Python è„šæœ¬
   python scripts/importer_main.py --file "bills/ä½ çš„è´¦å•.csv"
   ```

3. æŒ‰æç¤ºé€‰æ‹©è¦å¤„ç†çš„æ–‡ä»¶
4. ç³»ç»Ÿä¼šè‡ªåŠ¨è¯†åˆ«è´¦å•ç±»å‹å¹¶å¯¼å…¥

### 5. æŸ¥çœ‹æŠ¥è¡¨

å¯åŠ¨ Fava å¯è§†åŒ–ç•Œé¢ï¼š
```bash
# Windows
fava_run.bat

# æˆ–å‘½ä»¤è¡Œå¯åŠ¨
fava main.beancount
```

è®¿é—® `http://localhost:5000` æŸ¥çœ‹è´¢åŠ¡æŠ¥è¡¨ã€‚

## ğŸ“Š æ”¯æŒçš„è´¦å•æ ¼å¼

### æ”¯ä»˜å®è´¦å•
- æ–‡ä»¶ååŒ…å«"æ”¯ä»˜å®"æˆ–"alipay"å…³é”®è¯
- æ ‡å‡†æ”¯ä»˜å® CSV å¯¼å‡ºæ ¼å¼

### å¾®ä¿¡æ”¯ä»˜è´¦å•
- æ–‡ä»¶ååŒ…å«"å¾®ä¿¡"æˆ–"wechat"å…³é”®è¯  
- æ ‡å‡†å¾®ä¿¡æ”¯ä»˜ CSV å¯¼å‡ºæ ¼å¼

### é“¶è¡Œæµæ°´
- æ”¯æŒå„é“¶è¡Œ CSV æ ¼å¼
- è‡ªåŠ¨è¯†åˆ«å¸¸è§é“¶è¡Œè¡¨å¤´ç»“æ„

## ğŸ¤– AI åˆ†ç±»åŠŸèƒ½

ç³»ç»Ÿä½¿ç”¨ DeepSeek AI è¿›è¡Œæ™ºèƒ½åˆ†ç±»ï¼š

1. **è‡ªåŠ¨è¯†åˆ«**: æ ¹æ®äº¤æ˜“å¯¹æ–¹ã€å¤‡æ³¨ã€é‡‘é¢ç­‰ä¿¡æ¯æ™ºèƒ½åˆ†ç±»
2. **å­¦ä¹ è®°å¿†**: è®°ä½ç”¨æˆ·çš„åˆ†ç±»é€‰æ‹©ï¼Œä¸‹æ¬¡è‡ªåŠ¨åº”ç”¨
3. **äººå·¥ç¡®è®¤**: å¯¹ä¸ç¡®å®šçš„åˆ†ç±»ä¼šè¯·æ±‚ç”¨æˆ·ç¡®è®¤
4. **ç¼“å­˜æœºåˆ¶**: åˆ†ç±»æ˜ å°„ä¿å­˜åœ¨ `config/mapping.json` ä¸­

## ğŸ“ è´¦æœ¬ç®¡ç†

### æŒ‰æœˆåˆ†å·
- äº¤æ˜“æ•°æ®æŒ‰æœˆä»½è‡ªåŠ¨åˆ†å·å­˜å‚¨åœ¨ `data/` ç›®å½•
- æ–‡ä»¶å‘½åæ ¼å¼ï¼š`YYYYMM.beancount`ï¼ˆå¦‚ `202601.beancount`ï¼‰
- ä¸»è´¦æœ¬è‡ªåŠ¨åŒ…å«æ‰€æœ‰æœˆä»½æ–‡ä»¶

### æ–‡ä»¶å½’æ¡£
- å¤„ç†æˆåŠŸçš„è´¦å•è‡ªåŠ¨ç§»åŠ¨åˆ°å½’æ¡£ç›®å½•
- å¤±è´¥çš„æ–‡ä»¶ä¿ç•™åœ¨ `bills/` æ–‡ä»¶å¤¹ä¸­

## ğŸ”§ é«˜çº§é…ç½®

### è‡ªå®šä¹‰è´¦æˆ·æ˜ å°„
åœ¨ `config.json` ä¸­ä¿®æ”¹ `asset_mapping`ï¼š

```json
"asset_mapping": {
    "æ”¯ä»˜å®": "Assets:Alipay:Cash",
    "å¾®ä¿¡": "Assets:WeChat:Cash", 
    "å·¥å•†é“¶è¡Œ": "Assets:Bank:ICBC",
    "æ‹›å•†é“¶è¡Œ": "Assets:Bank:CMB"
}
```

### æ·»åŠ æ–°åˆ†ç±»
åœ¨ `my_accounts` ä¸­æ·»åŠ æ–°çš„è´¹ç”¨æˆ–æ”¶å…¥åˆ†ç±»ï¼š

```json
"my_accounts": [
    "Expenses:Food:Restaurant",
    "Expenses:Food:Grocery",
    "Expenses:Transport:Taxi",
    "Expenses:Transport:Subway",
    "Income:Bonus",
    "Income:Investment"
]
```

## ğŸ› ï¸ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **AI åˆ†ç±»å¤±è´¥**
   - æ£€æŸ¥ DeepSeek API key æ˜¯å¦æ­£ç¡®
   - ç¡®è®¤ç½‘ç»œè¿æ¥æ­£å¸¸

2. **è´¦å•è¯†åˆ«å¤±è´¥**
   - ç¡®è®¤è´¦å•æ–‡ä»¶æ ¼å¼æ­£ç¡®
   - æ£€æŸ¥æ–‡ä»¶åæ˜¯å¦åŒ…å«å¹³å°å…³é”®è¯

3. **Fava å¯åŠ¨å¤±è´¥**
   - ç¡®è®¤å·²å®‰è£… favaï¼š`pip install fava`
   - æ£€æŸ¥ä¸»è´¦æœ¬æ–‡ä»¶è¯­æ³•

### æ—¥å¿—æŸ¥çœ‹
ç³»ç»Ÿè¿è¡Œæ—¶çš„é”™è¯¯ä¿¡æ¯ä¼šæ˜¾ç¤ºåœ¨æ§åˆ¶å°ä¸­ï¼Œæ ¹æ®æç¤ºè¿›è¡Œç›¸åº”è°ƒæ•´ã€‚

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®ä¸ºä¸ªäººè®°è´¦å·¥å…·ï¼Œä»…ä¾›å­¦ä¹ å’Œä¸ªäººä½¿ç”¨ã€‚

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Request æ¥æ”¹è¿›è¿™ä¸ªé¡¹ç›®ã€‚

---

**å¼€å§‹ä½¿ç”¨è¿™ä¸ªæ™ºèƒ½è®°è´¦å·¥å…·ï¼Œè®©ä½ çš„è´¢åŠ¡ç®¡ç†æ›´åŠ é«˜æ•ˆï¼** ğŸ‰
